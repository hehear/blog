const logger = require('../../common/log4js');
const pool = require('../../common/mysqlPool');

const newsService={};

/**
 * 新增
 * @param news
 * @param callback
 */
newsService.add=function(news,callback){


}

/**
 * 修改
 * @param news
 * @param callback
 */
newsService.upt=function(news,callback){
    if(!news){
        callback('error');
    }

}

/**
 * 获取符合条件的数据条数
 * @param news
 * @param callback
 */
newsService.getTotal=function(news,callback){

}


/**
 * 分页查询数据
 * @param news 条件
 * @param page 分页信息
 * @param callback
 */
newsService.query4Page=function(news,page,callback){
    pool.query('select * from info  limit ?,?',[(page.pgindex-1)*page.pgsize,page.pgsize], function (err, rows1) {
        if (err) {
            logger.error(err);
            callback('error');
        }else{
            logger.info('load news list:%d 条',rows1.length);
            //callback(rows);
            pool.query('select count(*) as count from info ',function(err, rows){
                if(err){
                    logger.error(err);
                    callback('error');
                }else{
                    page.totalCount=rows[0].count;
                    page.pageCount=page.totalCount%page.pgsize==0?page.totalCount/page.pgsize:parseInt(page.totalCount/page.pgsize)+1;
                    callback(rows1,page);
                }
            });
        }

    });


}

/**
 * 修改数据状态
 * @param id
 * @param st
 * @param callback
 */
newsService.uptSt=function(id,st,callback){
    pool.query('update school set st=? where id=? ',[st,id], function (err) {
        if (err) {
            logger.error(err);
            callback('error');
        }else{
            logger.info('school修改成功：%d',id);
            callback('success');
        }
    });

}


module.exports=newsService;