const express = require('express');
const logger = require('../../common/log4js');
const router = express.Router();
const dayService=require('../service/dayService');
const resMsg = require('../model/resMsg');

//查询
router.get('/queryInfo', function (req, res) {
    logger.info('消息查询');


    var filter={
        st:'1',
        user_id:req.cookies.uid
    };

    infoService.queryInfo(filter,function(rows,count){

        if(rows==='error'){
            res.json(resMsg.getError('加载info出错啦'));
        }else{
            res.json(resMsg.getSuccess(rows,count));
        }
    })

});

router.post('/save', function (req, res) {

    logger.info('新建当日信息');

    var filter=req.body;

    filter.user_id=req.cookies.uid;

    dayService.add(filter,function(err){

        res.json(resMsg.getMessage(err));
    })



});

router.post('/updt', function (req, res) {

    logger.info('修改当日信息');

    var filter=req.body;

    filter.user_id=req.cookies.uid;

    dayService.upt(filter,function(err){

        res.json(resMsg.getMessage(err));
    })



});

router.post('/updtReadSt', function (req, res) {

    logger.info('阅读消息');

    var filter=req.body;

    filter.user_id=req.cookies.uid;

    infoService.updtReadSt(filter,function(rows){

        if(rows==='error'){
            res.json(resMsg.getError('加载info出错啦'));
        }else{
            res.json(resMsg.getSuccess(rows));
        }
    })

});

router.get('/delete', function (req, res) {

    var id=req.query.id;

    logger.info('删除消息，id：'+id);
    targetService.delete(id,function(err){

        res.json(resMsg.getMessage(err));
    })



});


//必须
module.exports = router;