const express = require('express');
const logger = require('../../common/log4js');
const router = express.Router();
const userService=require('../service/userService');
const resMsg = require('../model/resMsg');
const config=require("../../common/config");
// const jwt    = require('jsonwebtoken'); // 使用jwt签名

//登陆
router.post('/login', function (req, res) {
    logger.info('登陆');


    var filter = req.body;

    userService.login(filter, function (err,rows) {

        if (err) {
            res.json(resMsg.getError(err));
        } else {
            res.cookie( "secret", config.jwt.secret,{maxAge: config.jwt.expiresIn*1000, httpOnly: true});
            res.cookie( "uid",filter.uid,{maxAge: config.jwt.expiresIn*1000, httpOnly: true});

            res.json(resMsg.getSuccess(rows));
        }

    });
});

//获得当前登陆用户
router.get('/getCurrentUser', function (req, res) {
    logger.info('获得当前登陆用户');

    var uid=req.cookies.uid;

    res.json(resMsg.getSuccess(uid));

});


//必须
module.exports = router;