<?xml version="1.0" encoding="utf-8"?>
<search>


    <entry>
        <title>docker分离部署springboot并外置静态文件</title>
        <link href="/2019/05/17/docker%E5%88%86%E7%A6%BB%E9%83%A8%E7%BD%B2springboot%E5%B9%B6%E5%A4%96%E7%BD%AE%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6/"/>
        <url>
            /2019/05/17/docker%E5%88%86%E7%A6%BB%E9%83%A8%E7%BD%B2springboot%E5%B9%B6%E5%A4%96%E7%BD%AE%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6/
        </url>

        <content type="html">
            <![CDATA[<h2 id="打包springboot"><a href="#打包springboot" class="headerlink" title="打包springboot"></a>打包springboot</h2><h3 id="docker部署springboot项目时，每次上传war-jar包耗时耗力，并且每次都要修改配置文件，所以用docker部署时，将springboot项目打包时将项目的代码、静态文件、配置文件、lib分离，每次升级只需上传修改的代码即可，同时将静态文件等外挂到服务器，修改时只需修改完重启容器应用即可，无需重新build镜像。"><a href="#docker部署springboot项目时，每次上传war-jar包耗时耗力，并且每次都要修改配置文件，所以用docker部署时，将springboot项目打包时将项目的代码、静态文件、配置文件、lib分离，每次升级只需上传修改的代码即可，同时将静态文件等外挂到服务器，修改时只需修改完重启容器应用即可，无需重新build镜像。" class="headerlink" title="docker部署springboot项目时，每次上传war/jar包耗时耗力，并且每次都要修改配置文件，所以用docker部署时，将springboot项目打包时将项目的代码、静态文件、配置文件、lib分离，每次升级只需上传修改的代码即可，同时将静态文件等外挂到服务器，修改时只需修改完重启容器应用即可，无需重新build镜像。"></a>docker部署springboot项目时，每次上传war/jar包耗时耗力，并且每次都要修改配置文件，所以用docker部署时，将springboot项目打包时将项目的代码、静态文件、配置文件、lib分离，每次升级只需上传修改的代码即可，同时将静态文件等外挂到服务器，修改时只需修改完重启容器应用即可，无需重新build镜像。</h3><a id="more"></a><h5 id="1-修改pom-xml文件"><a href="#1-修改pom-xml文件" class="headerlink" title="1. 修改pom.xml文件"></a>1. 修改pom.xml文件</h5><ul><li><p>设定打成jar包</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.blog<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>MyBlog<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>build标签下设定打包的名称</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">finalName</span>&gt;</span>MyBlog<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>build plugins标签下配置打包成jar</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--打包jar--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclude</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclude</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.blog.MyBlogApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">addClasspath</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addClasspath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">classpathPrefix</span>&gt;</span>lib/<span class="tag">&lt;/<span class="name">classpathPrefix</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifestEntries</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Class-Path</span>&gt;</span>./<span class="tag">&lt;/<span class="name">Class-Path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifestEntries</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>build plugins标签下配置打包依赖lib</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--打包依赖lib--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">phase</span>&gt;</span>prepare-package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/lib<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>build plugins标签下配置打包resource</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--打包resource--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">phase</span>&gt;</span>prepare-package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>build resources标签下配置打包时将jsp文件拷贝到META-INF目录</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 打包时将jsp文件拷贝到META-INF目录下 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定resources插件处理哪个目录下的资源文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/webapp<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--注意此次必须要放在此目录下才能被访问到 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>META-INF/resources<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span>&gt;</span>**/**<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span>&gt;</span>**/**<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="2-打包springboot项目"><a href="#2-打包springboot项目" class="headerlink" title="2. 打包springboot项目"></a>2. 打包springboot项目</h5><h5 id="3-配置dockerfile"><a href="#3-配置dockerfile" class="headerlink" title="3. 配置dockerfile"></a>3. 配置dockerfile</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FROM frolvlad/alpine-oraclejdk8:slim</span><br><span class="line">VOLUME /tmp</span><br><span class="line">ARG DEPENDENCY=MyBlog</span><br><span class="line">COPY $&#123;DEPENDENCY&#125;/BOOT-INF/lib /app/lib</span><br><span class="line">COPY $&#123;DEPENDENCY&#125;/META-INF /app/META-INF</span><br><span class="line">COPY $&#123;DEPENDENCY&#125;/BOOT-INF/classes /app</span><br><span class="line">ENTRYPOINT ["java","-cp","app:app/lib/*","com.blog.MyBlogApplication"]</span><br></pre></td></tr></table></figure><h6 id="FROM-jdk，运行jar文件"><a href="#FROM-jdk，运行jar文件" class="headerlink" title="- FROM jdk，运行jar文件"></a>- FROM jdk，运行jar文件</h6><h6 id="VOLUME-tmp-springboot内置tomcat存放"><a href="#VOLUME-tmp-springboot内置tomcat存放" class="headerlink" title="- VOLUME /tmp springboot内置tomcat存放"></a>- VOLUME /tmp springboot内置tomcat存放</h6><h6 id="ARG-解压springboot的文件夹"><a href="#ARG-解压springboot的文件夹" class="headerlink" title="- ARG 解压springboot的文件夹"></a>- ARG 解压springboot的文件夹</h6><h6 id="COPY-将解压项目中的静态文件等copy到容器中指定位置，用于指定外挂"><a href="#COPY-将解压项目中的静态文件等copy到容器中指定位置，用于指定外挂" class="headerlink" title="- COPY 将解压项目中的静态文件等copy到容器中指定位置，用于指定外挂"></a>- COPY 将解压项目中的静态文件等copy到容器中指定位置，用于指定外挂</h6><h6 id="ENTRYPOINT-中com-blog-MyBlogApplication为springboot启动类"><a href="#ENTRYPOINT-中com-blog-MyBlogApplication为springboot启动类" class="headerlink" title="- ENTRYPOINT 中com.blog.MyBlogApplication为springboot启动类"></a>- ENTRYPOINT 中com.blog.MyBlogApplication为springboot启动类</h6><h5 id="4-在linux服务器上创建文件夹blog"><a href="#4-在linux服务器上创建文件夹blog" class="headerlink" title="4. 在linux服务器上创建文件夹blog"></a>4. 在linux服务器上创建文件夹blog</h5><h5 id="5-将解压的springboot项目、Dockerfile文件传输到服务器的blog文件夹"><a href="#5-将解压的springboot项目、Dockerfile文件传输到服务器的blog文件夹" class="headerlink" title="5. 将解压的springboot项目、Dockerfile文件传输到服务器的blog文件夹"></a>5. 将解压的springboot项目、Dockerfile文件传输到服务器的blog文件夹</h5><h5 id="6-docker-build镜像"><a href="#6-docker-build镜像" class="headerlink" title="6. docker build镜像"></a>6. docker build镜像</h5><ul><li>进入linux的blog文件夹</li><li>执行docker命令将springboot项目build成镜像</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t blog .</span><br></pre></td></tr></table></figure><h6 id="注意语句结束后的“-”-不可省略"><a href="#注意语句结束后的“-”-不可省略" class="headerlink" title="- 注意语句结束后的“.”,不可省略"></a>- 注意语句结束后的“.”,不可省略</h6><h5 id="7-创建容器，并外挂静态文件"><a href="#7-创建容器，并外挂静态文件" class="headerlink" title="7. 创建容器，并外挂静态文件"></a>7. 创建容器，并外挂静态文件</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --name myblog -it -p 8081:8080</span><br><span class="line">-v /etc/config/blog/META-INF:/app/META-INF</span><br><span class="line">-v /etc/config/blog/lib:/app/lib</span><br><span class="line">-v /etc/config/blog/static:/app/static</span><br><span class="line">-v /etc/config/blog/application.properties:/app/application.properties</span><br><span class="line">-d blog</span><br></pre></td></tr></table></figure><h6 id="–name容器名称"><a href="#–name容器名称" class="headerlink" title="- –name容器名称"></a>- –name容器名称</h6><h6 id="p-8081-8080-端口映射，8081服务器端口映射到容器的8080端口"><a href="#p-8081-8080-端口映射，8081服务器端口映射到容器的8080端口" class="headerlink" title="- -p 8081:8080 端口映射，8081服务器端口映射到容器的8080端口"></a>- -p 8081:8080 端口映射，8081服务器端口映射到容器的8080端口</h6><h6 id="v-etc-config-blog-META-INF-app-META-INF-将容器中-app-META-INF（jsp文件）挂载到服务器的-etc-config-blog-META-INF目录下，其他几个-v命令也是如此。"><a href="#v-etc-config-blog-META-INF-app-META-INF-将容器中-app-META-INF（jsp文件）挂载到服务器的-etc-config-blog-META-INF目录下，其他几个-v命令也是如此。" class="headerlink" title="- -v /etc/config/blog/META-INF:/app/META-INF 将容器中/app/META-INF（jsp文件）挂载到服务器的/etc/config/blog/META-INF目录下，其他几个-v命令也是如此。"></a>- -v /etc/config/blog/META-INF:/app/META-INF 将容器中/app/META-INF（jsp文件）挂载到服务器的/etc/config/blog/META-INF目录下，其他几个-v命令也是如此。</h6><h6 id="d-blog-镜像名称"><a href="#d-blog-镜像名称" class="headerlink" title="- -d blog 镜像名称"></a>- -d blog 镜像名称</h6><h5 id="到此部署成功"><a href="#到此部署成功" class="headerlink" title="到此部署成功"></a>到此部署成功</h5>]]></content>


    </entry>


</search>
